# üí≥ API de Pagamentos e Transfer√™ncias

[![CI/CD Pipeline](https://github.com/username/payments-api/workflows/CI/CD%20Pipeline/badge.svg)](https://github.com/username/payments-api/actions)
[![Coverage](https://codecov.io/gh/username/payments-api/branch/main/graph/badge.svg)](https://codecov.io/gh/username/payments-api)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Java](https://img.shields.io/badge/Java-17-orange.svg)](https://openjdk.java.net/projects/jdk/17/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.0-brightgreen.svg)](https://spring.io/projects/spring-boot)

Uma API REST completa e segura para pagamentos e transfer√™ncias, desenvolvida com Java 17, Spring Boot 3, autentica√ß√£o JWT, controle de acesso RBAC, PostgreSQL e recursos avan√ßados de seguran√ßa.

## üöÄ In√≠cio R√°pido

### Pr√©-requisitos

- **Docker** e **Docker Compose** (recomendado)
- **Java 17** (para desenvolvimento local)
- **Maven 3.6+** (para desenvolvimento local)
- **PostgreSQL 15+** (se n√£o usar Docker)

### Setup com Docker (Recomendado)

```bash
# Clone o reposit√≥rio
git clone https://github.com/username/payments-api.git
cd payments-api

# Execute o script de setup
./scripts/setup.sh

# Ou manualmente:
docker-compose up -d
```

### Setup Local

```bash
# Clone o reposit√≥rio
git clone https://github.com/username/payments-api.git
cd payments-api

# Configure o banco PostgreSQL
createdb payments_db

# Configure as vari√°veis de ambiente
export DB_USERNAME=payments_user
export DB_PASSWORD=payments_pass
export JWT_SECRET=mySecretKey123456789012345678901234567890

# Execute a aplica√ß√£o
mvn spring-boot:run
```

### Verifica√ß√£o da Instala√ß√£o

Ap√≥s o setup, verifique se a API est√° funcionando:

```bash
# Health check
curl http://localhost:8080/actuator/health

# Swagger UI
open http://localhost:8080/swagger-ui.html
```

## üìã Funcionalidades

### ‚úÖ Funcionalidades M√≠nimas

- **Autentica√ß√£o Segura**: Sistema completo de registro e login com JWT
- **Consulta de Saldo**: Verifica√ß√£o de saldo com auditoria completa
- **Transfer√™ncias Internas**: Transfer√™ncias entre contas com valida√ß√µes
- **Limite Di√°rio**: Controle autom√°tico de limites de transfer√™ncia
- **Logs de Auditoria**: Rastreamento completo de todas as opera√ß√µes

### üåü Recursos Extras

- **Rate Limiting**: Prote√ß√£o contra abuso e ataques de for√ßa bruta
- **OpenAPI/Swagger**: Documenta√ß√£o interativa da API
- **Testcontainers**: Testes de integra√ß√£o com banco real
- **CI/CD**: Pipeline completo com GitHub Actions
- **Cobertura de Testes**: Mais de 70% de cobertura com JaCoCo
- **Docker**: Containeriza√ß√£o completa para deployment
- **Monitoramento**: Health checks e m√©tricas com Actuator

## üèóÔ∏è Arquitetura

![Diagrama de Arquitetura](https://private-us-east-1.manuscdn.com/sessionFile/pJzUdEReWLoaqAy2O3VusN/sandbox/wgXFrcKP9kIb9bkwUGJLuz-images_1756145643739_na1fn_L2hvbWUvdWJ1bnR1L3BheW1lbnRzLWFwaS9kb2NzL2FyY2hpdGVjdHVyZS1kaWFncmFt.png?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9wcml2YXRlLXVzLWVhc3QtMS5tYW51c2Nkbi5jb20vc2Vzc2lvbkZpbGUvcEp6VWRFUmVXTG9hcUF5Mk8zVnVzTi9zYW5kYm94L3dnWEZyY0tQOWtJYjlia3dVR0pMdXotaW1hZ2VzXzE3NTYxNDU2NDM3MzlfbmExZm5fTDJodmJXVXZkV0oxYm5SMUwzQmhlVzFsYm5SekxXRndhUzlrYjJOekwyRnlZMmhwZEdWamRIVnlaUzFrYVdGbmNtRnQucG5nIiwiQ29uZGl0aW9uIjp7IkRhdGVMZXNzVGhhbiI6eyJBV1M6RXBvY2hUaW1lIjoxNzk4NzYxNjAwfX19XX0_&Key-Pair-Id=K2HSFNDJXOU9YS&Signature=X0Y0hZ069isDAALpPxUp38240ALTT~IOAngZX2hRSDCq6cbKM0dfx6c8-MFpqrALsJcggyfFtknscSUJerKAD5OiKanqSaFzmn1pa36cZpxeslDhbinuVEL4m0nHttxoYE7WeFPg6oiHeNxzr6LT9YcMKtRowBkh2rDg-oiJznJwzXvOPqEtBPo0TaI5jUoMjDZtKGlBdyXm-l8~XGZ6-7ggZGpUsQyD~fpEl4n9xsWgrGoNShZIxJbfOFW-rOiScXnmi7l~PCF0IGkFeBmZjKczOIj6fXCrHOAuWEWVi4DYM7UVGEXB7~iIpqfR6qffT0GPnJOB2JYkyBSmyrqJuA__)

### Stack Tecnol√≥gico

| Componente | Tecnologia | Vers√£o |
|------------|------------|--------|
| **Runtime** | Java | 17 |
| **Framework** | Spring Boot | 3.2.0 |
| **Seguran√ßa** | Spring Security | 6.2.0 |
| **Banco de Dados** | PostgreSQL | 15 |
| **Migra√ß√£o** | Flyway | 9.x |
| **Autentica√ß√£o** | JWT (JJWT) | 0.12.3 |
| **Rate Limiting** | Bucket4j | 7.6.0 |
| **Documenta√ß√£o** | SpringDoc OpenAPI | 2.2.0 |
| **Testes** | Testcontainers | 1.19.3 |
| **Build** | Maven | 3.6+ |
| **Containeriza√ß√£o** | Docker | 20+ |

### Padr√µes Arquiteturais

- **Layered Architecture**: Separa√ß√£o clara entre Controller, Service e Repository
- **Dependency Injection**: Invers√£o de controle com Spring IoC
- **Repository Pattern**: Abstra√ß√£o de acesso a dados com Spring Data JPA
- **DTO Pattern**: Objetos de transfer√™ncia para APIs
- **Builder Pattern**: Constru√ß√£o de objetos complexos
- **Strategy Pattern**: Diferentes estrat√©gias de autentica√ß√£o e autoriza√ß√£o

## üîê Seguran√ßa

### Autentica√ß√£o e Autoriza√ß√£o

- **JWT Tokens**: Tokens assinados com HS256 e expira√ß√£o configur√°vel
- **RBAC**: Controle de acesso baseado em pap√©is (USER, ADMIN)
- **BCrypt**: Criptografia de senhas com salt autom√°tico
- **CORS**: Configura√ß√£o segura para requisi√ß√µes cross-origin

### Prote√ß√µes Implementadas

- **Rate Limiting**: 60 req/min por IP com burst de 10 req/10s
- **Valida√ß√£o de Entrada**: Sanitiza√ß√£o e valida√ß√£o de todos os dados
- **SQL Injection**: Prote√ß√£o autom√°tica com JPA/Hibernate
- **XSS**: Headers de seguran√ßa configurados
- **CSRF**: Prote√ß√£o contra ataques cross-site

### Auditoria

Todas as opera√ß√µes s√£o registradas com:
- A√ß√£o realizada e timestamp
- Usu√°rio respons√°vel e IP de origem
- Detalhes da opera√ß√£o
- N√≠vel de severidade (INFO, WARNING, ERROR, CRITICAL)

## üìñ Documenta√ß√£o da API

### Endpoints Principais

#### Autentica√ß√£o

```http
POST /api/auth/signup
POST /api/auth/signin
```

#### Contas

```http
GET /api/accounts/my-accounts
GET /api/accounts/{id}/balance
GET /api/accounts/{id}/daily-limit
```

#### Transfer√™ncias

```http
POST /api/accounts/transfer
```

#### Administra√ß√£o

```http
GET /api/admin/audit-logs
GET /api/admin/audit-logs/user/{userId}
GET /api/admin/audit-logs/action/{action}
```

### Exemplos de Uso

#### Registro de Usu√°rio

```bash
curl -X POST http://localhost:8080/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{
    "username": "joaosilva",
    "email": "joao.silva@email.com",
    "password": "minhasenha123",
    "fullName": "Jo√£o Silva"
  }'
```

#### Login

```bash
curl -X POST http://localhost:8080/api/auth/signin \
  -H "Content-Type: application/json" \
  -d '{
    "username": "joaosilva",
    "password": "minhasenha123"
  }'
```

#### Consulta de Saldo

```bash
curl -X GET http://localhost:8080/api/accounts/1/balance \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

#### Transfer√™ncia

```bash
curl -X POST http://localhost:8080/api/accounts/transfer \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "fromAccountNumber": "1234567890",
    "toAccountNumber": "0987654321",
    "amount": 250.00,
    "description": "Pagamento de servi√ßos"
  }'
```

## üß™ Testes

### Executar Testes

```bash
# Todos os testes
mvn test

# Apenas testes unit√°rios
mvn test -Dtest="*Test"

# Apenas testes de integra√ß√£o
mvn test -Dtest="*IntegrationTest"

# Com relat√≥rio de cobertura
mvn clean test jacoco:report
```

### Cobertura de Testes

- **Testes Unit√°rios**: Servi√ßos, utilit√°rios e componentes isolados
- **Testes de Integra√ß√£o**: Controllers com banco real via Testcontainers
- **Testes de Seguran√ßa**: Autentica√ß√£o, autoriza√ß√£o e valida√ß√µes
- **Cobertura M√≠nima**: 70% (configurado com JaCoCo)

### Estrutura de Testes

```
src/test/java/
‚îú‚îÄ‚îÄ com/payments/api/
‚îÇ   ‚îú‚îÄ‚îÄ controller/          # Testes de integra√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ service/             # Testes unit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ security/            # Testes de seguran√ßa
‚îÇ   ‚îî‚îÄ‚îÄ BaseIntegrationTest  # Classe base para testes
```

## üöÄ Deployment

### Docker

```bash
# Build da imagem
docker build -t payments-api .

# Executar com Docker Compose
docker-compose up -d

# Verificar logs
docker-compose logs -f payments-api
```

### Vari√°veis de Ambiente

| Vari√°vel | Descri√ß√£o | Padr√£o |
|----------|-----------|--------|
| `DB_USERNAME` | Usu√°rio do banco | `payments_user` |
| `DB_PASSWORD` | Senha do banco | `payments_pass` |
| `JWT_SECRET` | Chave secreta JWT | `mySecretKey...` |
| `JWT_EXPIRATION` | Expira√ß√£o do token (ms) | `86400000` |
| `APP_DAILY_TRANSFER_LIMIT` | Limite di√°rio padr√£o | `10000.00` |
| `RATE_LIMIT_REQUESTS_PER_MINUTE` | Limite de requisi√ß√µes | `60` |

### CI/CD

O projeto inclui pipeline completo com GitHub Actions:

- **Build e Testes**: Execu√ß√£o autom√°tica em push/PR
- **Security Scan**: OWASP Dependency Check
- **Docker Build**: Build multi-arquitetura (amd64/arm64)
- **Deploy**: Staging e produ√ß√£o automatizados
- **Notifica√ß√µes**: Integra√ß√£o com Slack/email

## üìä Monitoramento

### Health Checks

```bash
# Status da aplica√ß√£o
curl http://localhost:8080/actuator/health

# M√©tricas detalhadas
curl http://localhost:8080/actuator/metrics

# Informa√ß√µes da aplica√ß√£o
curl http://localhost:8080/actuator/info
```

### Logs

```bash
# Logs da aplica√ß√£o
docker-compose logs -f payments-api

# Logs do banco
docker-compose logs -f postgres

# Logs com filtro
docker-compose logs payments-api | grep ERROR
```

## üîß Desenvolvimento

### Estrutura do Projeto

```
payments-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/payments/api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/      # Controllers REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/         # L√≥gica de neg√≥cio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/      # Acesso a dados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity/          # Entidades JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/             # DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security/        # Configura√ß√µes de seguran√ßa
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/          # Configura√ß√µes gerais
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml  # Configura√ß√µes
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ db/migration/    # Scripts Flyway
‚îÇ   ‚îî‚îÄ‚îÄ test/                    # Testes
‚îú‚îÄ‚îÄ docs/                        # Documenta√ß√£o
‚îú‚îÄ‚îÄ scripts/                     # Scripts utilit√°rios
‚îú‚îÄ‚îÄ .github/workflows/           # CI/CD
‚îú‚îÄ‚îÄ docker-compose.yml           # Orquestra√ß√£o Docker
‚îú‚îÄ‚îÄ Dockerfile                   # Imagem Docker
‚îî‚îÄ‚îÄ pom.xml                      # Depend√™ncias Maven
```

### Comandos √öteis

```bash
# Desenvolvimento local
mvn spring-boot:run

# Build completo
mvn clean package

# Executar com profile espec√≠fico
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# Debug
mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"

# An√°lise de depend√™ncias
mvn dependency:tree

# Verifica√ß√£o de vulnerabilidades
mvn org.owasp:dependency-check-maven:check
```

## üìö Documenta√ß√£o Adicional

- **[Documenta√ß√£o T√©cnica Completa](docs/API_Documentation.md)**: Especifica√ß√µes detalhadas da API
- **[Checklist de Seguran√ßa](docs/Security_Checklist.md)**: Verifica√ß√µes e boas pr√°ticas
- **[Diagrama de Arquitetura](docs/architecture-diagram.png)**: Vis√£o visual do sistema

## ü§ù Contribui√ß√£o

### Como Contribuir

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

### Padr√µes de C√≥digo

- **Java Code Style**: Google Java Style Guide
- **Commit Messages**: Conventional Commits
- **Branch Naming**: `feature/`, `bugfix/`, `hotfix/`
- **Tests**: Cobertura m√≠nima de 70%

### Code Review

Todos os PRs passam por:
- Revis√£o de c√≥digo por pelo menos 2 desenvolvedores
- Execu√ß√£o completa da suite de testes
- Verifica√ß√£o de seguran√ßa automatizada
- An√°lise de cobertura de c√≥digo

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë• Equipe

- **Desenvolvedor Principal**: Manus AI
- **Arquitetura**: Sistema baseado em Spring Boot com foco em seguran√ßa
- **DevOps**: Pipeline CI/CD com Docker e GitHub Actions

## üìû Suporte

- **Issues**: [GitHub Issues](https://github.com/username/payments-api/issues)
- **Documenta√ß√£o**: [Wiki do Projeto](https://github.com/username/payments-api/wiki)
- **Email**: support@payments-api.com

## üéØ Roadmap

### Vers√£o 2.0 (Planejada)

- [ ] Autentica√ß√£o em duas etapas (2FA)
- [ ] Integra√ß√£o com PIX
- [ ] API de webhooks para notifica√ß√µes
- [ ] Dashboard administrativo
- [ ] Relat√≥rios financeiros avan√ßados

### Vers√£o 2.1 (Futuro)

- [ ] Machine Learning para detec√ß√£o de fraudes
- [ ] Integra√ß√£o com blockchain
- [ ] API GraphQL
- [ ] Aplicativo m√≥vel
- [ ] Suporte a m√∫ltiplas moedas

---

**Desenvolvido com ‚ù§Ô∏è usando Java 17 e Spring Boot 3**


